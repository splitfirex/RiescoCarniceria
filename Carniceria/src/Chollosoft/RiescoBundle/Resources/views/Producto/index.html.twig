{% extends 'CarniceriaBundle::layout.html.twig' %} {% block javascript
%}
<script type="text/javascript">
    $(function(){
      $("#shopping_cart_button").on("click",function(){

        if($(this).data("estado")==="productos"){
            $(this).data("estado","carro");
            $("#category").toggle( "slide", {}, 200 ).promise().done(function(){
                $("#shopping_cart").toggle( "slide", {}, 200 );
                $(".content").switchClass( "", "shopping", 200, "easeInOutQuad" );
                $("#shopping_cart_button").css("background-image","url('{{ asset('bundles/carniceria/images/cart-inverted.png') }}')");
            });
        }else{
            $(this).data("estado","productos");
             $("#shopping_cart").toggle( "slide", {}, 200 ).promise().done(function(){
                $("#category").toggle( "slide", {}, 300);
                $(".content").switchClass( "shopping", "", 200, "easeInOutQuad" );
                $("#shopping_cart_button").css("background-image","url('{{ asset('bundles/carniceria/images/cart.png') }}')");
            });
        }  

    });

      

		$(".spinner").spinner();
      
      $('.categoria-filter').on("click", function(){
			var cat = $(this).data("categoria");

			 $.getJSON("{{ url('categoria_listar') }}",{ idCategoria: cat }, poblarProductos);

			
          });
      
      $.getJSON("{{ url('categoria_listar') }}",{ idCategoria: '0' }, poblarProductos);
      $.getJSON("{{ url('carro_listar') }}", poblarCarro);
      
      });


    function poblarCarro(data){
		$(".carro-productos").html("");

		for (key in data) {
			var row = $("<tr></tr>");

			var src = "{{  asset("uploads/") }}"+data[key].id_producto.filename;
			row.append($("<td></td>").html("<img src=\""+src+"\" style='margin-bottom: 0px' width='40px' height='40px'>"));
			row.append($("<td></td>").html("<strong>"+data[key].id_producto.nombre+"</strong>"));
			row.append($("<td></td>").html('Disponible : '+data[key].id_producto.stock+ ''+data[key].id_producto.unidad_de_compra +"    <strong> Precio por "+ data[key].id_producto.unidad_de_compra +": \u20AC "+data[key].precio_producto +'</strong>'));

			var spin = $( "<input class='spinner' value='"+data[key].cantidad+"' style='width:25px; margin-right:0px;  border-width:1px'>" );
			var addCart = $("<td></td>");
			addCart.append(spin);
			addCart.append(data[key].id_producto.unidad_de_compra);
			addCart.append("<a href='javascript:void(0);' data-producto='"+data[key].id+"'  class='addCart'><span class='fa fa-shopping-cart'></span>Eliminar del carro</a>");
			row.append(addCart);
			$(".carro-productos").append(row);
		}

		$('.addCart').on("click", function(){

	          $.post('{{ url("carro_create") }}',{ idProducto: $(this).data('producto'), cantidad: '100' }, function( data ) {
	        	  alert( data );
	          });
	    	  
	      });

    }

    function poblarProductos(data){
		$(".categoria-titulo").html("Categoria: "+data.nombre+" > Productos");
		$(".categoria-descripcion").html(data.descripcion);
		$(".categoria-productos").html("");
	
		for (key in data.productos) {
			var row = $("<tr></tr>");

			var src = "{{  asset("uploads/") }}"+data.productos[key].filename;
			row.append($("<td></td>").html("<img src=\""+src+"\" style='margin-bottom: 0px' width='40px' height='40px'>"));
			row.append($("<td></td>").html("<strong>"+data.productos[key].nombre+"</strong>"));
			row.append($("<td></td>").html('Disponible : '+data.productos[key].stock+ ''+data.productos[key].unidad_de_compra +"    <strong> Precio : \u20AC "+data.productos[key].precio +'</strong>'));

			var spin = $( "<input class='spinner' name='cantidad'  style='width:25px; margin-right:0px;  border-width:1px'>" );
			var addCart = $("<td></td>");
			addCart.append(spin);
			addCart.append("<a href='javascript:void(0);' data-producto='"+data.productos[key].id+"'  class='addCart'><span class='fa fa-shopping-cart'></span>Agregar Al carro</a>");
			row.append(addCart);
			$(".categoria-productos").append(row);
		}

		$('.addCart').on("click", function(){
			  var cantidadSeleccionada = $(this).prev('input[name="cantidad"]').val();	
	          $.post('{{ url("carro_create") }}',{ idProducto: $(this).data('producto'), cantidad: cantidadSeleccionada }, function( data ) {
	        	  alert( data );
	        	  $.getJSON("{{ url('carro_listar') }}", poblarCarro);
	          });

	    	  
	      });
	
        }

    
    </script>
{% endblock %} {% block body -%}
<section class="content">
	<div class="container">



		<div class="row">


			<div class="grid_4 preffix_1" style="width: 200px">
				<h2>Categorias</h2>
				<ul class="list">
					{% for categoria in categorias %}
					<li><a href="javascript:void(0);"
						data-categoria="{{ categoria.id }}" class="categoria-filter">{{
							categoria.nombre }}</a></li> {% endfor %}
					<li><a data-categoria="0" class="categoria-filter"
						href="javascript:void(0);"><b>TODAS</b></a></li>
				</ul>
			</div>
			<div class="grid_7" id="category">
				<div class="blog">
					<h1 class="blog_title categoria-titulo"></h1>
					<p class="categoria-descripcion"></p>
					<table>
						<tbody class="categoria-productos">
						</tbody>
					</table>
				</div>
			</div>
			<div class="grid_7" style="background-color: #969696; display: none"
				id="shopping_cart">
				<div class="blog">
					<div class="blog_title">
						<a href="#">Productos del carro</a>
					</div>
					<p>Alerta! Los productos en este carro de compra podrian no estar disponibles al momento de realizar el pedido de envio.</p>
					<table>
						<tbody class="carro-productos">
							
						</tbody>
					</table>
				</div>
			</div>
			<div id="shopping_cart_button"
				style="width:100px; height:100px; margin-top:60px;  float: right;  z-index:999; overflow: auto; display:block; background-image: url('{{ asset('bundles/carniceria/images/cart.png') }}') ; background-size: 100px 100px;  background-repeat: no-repeat; cursor:pointer;"
				data-estado="productos"></div>
		</div>
	</div>
</section>



{% endblock %}
